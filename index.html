<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù…ÛŒÙˆÙ†</title>

<!-- Neshan Map -->
<link rel="stylesheet" href="https://static.neshan.org/sdk/leaflet/1.4.0/leaflet.css">
<script src="https://static.neshan.org/sdk/leaflet/1.4.0/leaflet.js"></script>

<style>
body{margin:0;font-family:tahoma;background:#f4f6f8}
header{
  height:60px;background:#0f172a;color:#fff;
  display:flex;align-items:center;padding:0 20px;font-size:18px
}
.container{display:flex;height:calc(100vh - 60px)}
.sidebar{
  width:330px;background:#111827;color:#fff;
  padding:15px;overflow:auto
}
.sidebar h3{margin-top:0}
.sidebar input,.sidebar button{
  width:100%;padding:8px;margin:6px 0;
  border-radius:6px;border:none
}
.sidebar button{background:#2563eb;color:#fff;cursor:pointer}
.sidebar button:hover{background:#1d4ed8}
#map{flex:1}
.results{
  background:#fff;padding:10px;border-top:1px solid #ddd
}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#f1f5f9}
</style>
</head>

<body>

<header>ğŸšš Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„</header>

<div class="container">
  <aside class="sidebar">
    <h3>ğŸ“‚ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</h3>

    <input type="file" id="file">
    <input id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ (Ú©Ø¯ / Ø´Ù‡Ø± / Ù…Ø³Ø¦ÙˆÙ„)">

    <button onclick="calculateRoute()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ± Ú©Ø§Ù…ÛŒÙˆÙ†</button>

    <p style="font-size:12px;opacity:.8">
      ğŸ“ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ = Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù†Ø¨Ø§Ø±
    </p>
  </aside>

  <main id="map"></main>
</div>

<section class="results">
  <h3>ğŸ“Š Ù†ØªØ§ÛŒØ¬</h3>
  <table id="result">
    <tr>
      <th>Ú©Ø¯ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</th>
      <th>Ù…Ø³Ø§ÙØª Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª (km)</th>
    </tr>
  </table>
</section>

<script>
/* ===== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ===== */
const API_KEY = "API_KEY_Ø®ÙˆØ¯Øª";
let warehouse = null;
let stores = [];
let selected = [];
let map;

/* ===== Ù†Ù‚Ø´Ù‡ ===== */
map = new L.Map("map",{
  key:API_KEY,
  center:[35.6892,51.3890],
  zoom:10
});

/* Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù†Ø¨Ø§Ø± Ø¨Ø§ Ú©Ù„ÛŒÚ© */
map.on('click',e=>{
  warehouse = e.latlng;
  L.marker(warehouse).addTo(map)
    .bindPopup("Ø§Ù†Ø¨Ø§Ø±").openPopup();
});

/* ===== Ø§Ú©Ø³Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ===== */
document.getElementById('file').addEventListener('change',e=>{
  alert("ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ (Ø§ØªØµØ§Ù„ Ø§Ú©Ø³Ù„ Ø¯Ø± ÙØ§Ø² Ø¨Ø¹Ø¯ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯)");
});

/* ===== Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ ===== */
async function calculateRoute(){
  if(!warehouse){
    alert("Ø§Ù†Ø¨Ø§Ø± Ø±Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†");
    return;
  }

  document.getElementById("result").innerHTML = `
    <tr><th>Ú©Ø¯ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</th><th>Ù…Ø³Ø§ÙØª Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª (km)</th></tr>
  `;

  // Ù†Ù…ÙˆÙ†Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ØªØ³ØªÛŒ
  const sample = [
    {code:1001,lat:35.73,lng:51.41},
    {code:1002,lat:35.67,lng:51.30}
  ];

  for(let s of sample){
    const url = `https://api.neshan.org/v4/direction?type=truck&origin=${warehouse.lat},${warehouse.lng}&destination=${s.lat},${s.lng}`;

    const res = await fetch(url,{
      headers:{'Api-Key':API_KEY}
    });
    const data = await res.json();

    const km = (data.routes[0].legs[0].distance.value*2/1000).toFixed(1);

    document.getElementById("result").innerHTML += `
      <tr>
        <td>${s.code}</td>
        <td>${km}</td>
      </tr>
    `;
  }
}
</script>

</body>
</html>
