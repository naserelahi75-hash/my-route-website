<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>محاسبه میانگین مسیر (OpenRouteService)</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h1 { font-size: 22px; }
    label { display:block; margin-top:12px; font-weight:bold; }
    input { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #ccc; }
    button { margin-top:20px; padding:12px; width:100%; border:none; border-radius:10px; background:#2563eb; color:white; font-size:16px; cursor:pointer; }
    .result { margin-top:20px; background:#f0f9ff; padding:15px; border-radius:10px; }
  </style>
</head>
<body>
<div class="container">
  <h1>محاسبه خودکار ۳ مسیر و میانگین (کامیون)</h1>

  <label>API Key (OpenRouteService)</label>
  <input id="apiKey" placeholder="کلید API خود را وارد کنید" />

  <label>مختصات مبدا (lat,lng)</label>
  <input id="start" placeholder="35.7502627049869,51.47996117059361" />

  <label>مختصات مقصد (lat,lng)</label>
  <input id="end" placeholder="35.67058669126419,51.29619187580553" />

  <button onclick="calculateRoutes()">محاسبه مسیرها</button>

  <div class="result" id="result"></div>
</div>

<script>
async function calculateRoutes() {
  const apiKey = document.getElementById('apiKey').value.trim();
  const start = document.getElementById('start').value.split(',').map(Number);
  const end = document.getElementById('end').value.split(',').map(Number);

  if (!apiKey || start.length!==2 || end.length!==2) {
    alert('اطلاعات را کامل وارد کنید'); return;
  }

  const body = {
    coordinates: [ [start[1], start[0]], [end[1], end[0]] ],
    alternative_routes: { count: 3 }
  };

  const res = await fetch('https://api.openrouteservice.org/v2/directions/driving-hgv', {
    method: 'POST',
    headers: {
      'Authorization': apiKey,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (!data.routes) { alert('خطا در دریافت مسیر'); return; }

  let sum = 0;
  let html = '<b>نتایج مسیرها:</b><br>';

  data.routes.forEach((r, i) => {
    const km = (r.summary.distance / 1000).toFixed(2);
    sum += parseFloat(km);
    html += `مسیر ${i+1}: ${km} کیلومتر<br>`;
  });

  html += `<hr><b>میانگین:</b> ${(sum / data.routes.length).toFixed(2)} کیلومتر`;
  document.getElementById('result').innerHTML = html;
}
</script>
</body>
</html>
