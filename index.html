<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>naser.ir | Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: sans-serif;
  background: #0b1220;
  color: #fff;
}

#login, #app {
  height: 100%;
}

#login {
  display: flex;
  justify-content: center;
  align-items: center;
}

.login-box {
  background: #111827;
  padding: 30px;
  border-radius: 10px;
  width: 300px;
}

.login-box input {
  width: 100%;
  margin: 8px 0;
  padding: 8px;
}

button {
  width: 100%;
  padding: 10px;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

#app {
  display: flex;
}

#sidebar {
  width: 300px;
  background: #020617;
  padding: 12px;
  box-sizing: border-box;
}

#map {
  flex: 1;
  height: 100%;
}

input {
  width: 100%;
  padding: 6px;
  margin: 6px 0;
}
</style>
</head>

<body>

<div id="login">
  <div class="login-box">
    <h3>ÙˆØ±ÙˆØ¯</h3>
    <input id="user" placeholder="username" />
    <input id="pass" type="password" placeholder="password" />
    <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
  </div>
</div>

<div id="app" style="display:none">
  <div id="sidebar">
    <h4>ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ù†Ø¨Ø§Ø±</h4>
    <small>Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†</small>
    <div id="warehouseInfo"></div>

    <hr>

    <h4>ğŸ” Ø¬Ø³ØªØ¬Ùˆ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ (Ú©Ø¯)</h4>
    <input id="storeCode" placeholder="Ù…Ø«Ø§Ù„: 1008" />
    <button onclick="findStore()">Ù†Ù…Ø§ÛŒØ´ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</button>

    <hr>
    <div id="result"></div>
  </div>

  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ================= CONFIG ================= */
const USERNAME = "naser";
const PASSWORD = "12345";
const NESHAN_KEY = "YOUR_NESHAN_API_KEY";

/* ===== ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ (Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†) ===== */
const storesData = [
  {
    code: "1008",
    name: "Ø§Ø­Ù…Ø¯ÛŒ",
    city: "ØªÙ‡Ø±Ø§Ù†",
    lat: 35.6892,
    lng: 51.3890
  },
  {
    code: "2001",
    name: "Ú©Ø±ÛŒÙ…ÛŒ",
    city: "Ú©Ø±Ø¬",
    lat: 35.8400,
    lng: 50.9391
  }
];

let map, warehouseMarker, storeMarker;
let warehouseLatLng = null;

/* ================= LOGIN ================= */
function login() {
  const u = document.getElementById("user").value;
  const p = document.getElementById("pass").value;
  if (u === USERNAME && p === PASSWORD) {
    localStorage.setItem("login", "1");
    initApp();
  } else {
    alert("ÛŒÙˆØ²Ø± ÛŒØ§ Ù¾Ø³ÙˆØ±Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡");
  }
}

document.addEventListener("keydown", e => {
  if (e.key === "Enter" && document.getElementById("login").style.display !== "none") {
    login();
  }
});

function initApp() {
  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "flex";
  initMap();
}

if (localStorage.getItem("login") === "1") {
  initApp();
}

/* ================= MAP ================= */
function initMap() {
  map = L.map("map").setView([35.6892, 51.3890], 11);

  L.tileLayer(
    `https://api.neshan.org/v2/static?key=${NESHAN_KEY}`,
    { attribution: "Neshan" }
  ).addTo(map);

  map.on("click", e => {
    warehouseLatLng = e.latlng;
    if (warehouseMarker) map.removeLayer(warehouseMarker);
    warehouseMarker = L.marker(e.latlng).addTo(map).bindPopup("ğŸ“¦ Ø§Ù†Ø¨Ø§Ø±").openPopup();
    document.getElementById("warehouseInfo").innerText =
      `Lat: ${e.latlng.lat.toFixed(5)} , Lng: ${e.latlng.lng.toFixed(5)}`;
  });
}

/* ================= STORE ================= */
function findStore() {
  if (!warehouseLatLng) {
    alert("Ø§ÙˆÙ„ Ø§Ù†Ø¨Ø§Ø± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†");
    return;
  }

  const code = document.getElementById("storeCode").value.trim();
  const store = storesData.find(s => s.code === code);

  if (!store) {
    alert("ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
    return;
  }

  if (storeMarker) map.removeLayer(storeMarker);

  storeMarker = L.marker([store.lat, store.lng])
    .addTo(map)
    .bindPopup(`
      <b>${store.name}</b><br>
      ${store.city}<br>
      Ú©Ø¯: ${store.code}
    `)
    .openPopup();

  const d = calcDistance(
    warehouseLatLng.lat,
    warehouseLatLng.lng,
    store.lat,
    store.lng
  );

  document.getElementById("result").innerHTML = `
    <b>ÙØ±ÙˆØ´Ú¯Ø§Ù‡:</b> ${store.name}<br>
    <b>Ø´Ù‡Ø±:</b> ${store.city}<br>
    <b>Ø±ÙØª Ùˆ Ø¨Ø±Ú¯Ø´Øª:</b> ${(d * 2).toFixed(2)} km
  `;

  map.fitBounds([
    [warehouseLatLng.lat, warehouseLatLng.lng],
    [store.lat, store.lng]
  ]);
}

/* ================= DISTANCE ================= */
function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a =
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1*Math.PI/180) *
    Math.cos(lat2*Math.PI/180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}
</script>

</body>
</html>
